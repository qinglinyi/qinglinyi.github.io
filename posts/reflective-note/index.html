<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="知其然知其所以然"><title>Java反射--笔记 | 青林亦</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java反射--笔记</h1><a id="logo" href="/.">青林亦</a><p class="description">知其然知其所以然</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java反射--笔记</h1><div class="post-meta">Apr 16, 2016<span> | </span><span class="category"><a href="/categories/Java/">Java</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>本文是《Java 核心技术 卷I》关于反射内容的读书笔记以及理解。</p>
<h2 id="1-是什么"><a href="#1-是什么" class="headerlink" title="1. 是什么"></a>1. 是什么</h2><blockquote>
<p>反射机制：程序运行时，允许改变程序结构或变量类型的机制。Reflection，用在Java身上指的是我们可以于运行时加载、探知、使用编译期间完全未知的classes。</p>
</blockquote>
<p>我的理解就是：反射就是在程序运行时能够动态操作Java代码的程序（或者叫机制）。</p>
<blockquote>
<p>反射是一种功能强大且复杂的机制。使用它的主要是对象是工具构造者，而不是应用程序员。</p>
</blockquote>
<h2 id="2-功能"><a href="#2-功能" class="headerlink" title="2. 功能"></a>2. 功能</h2><ol>
<li>运行中分析类</li>
<li>运行中构造任意类对象</li>
<li>运行中操作对象的方法</li>
</ol>
<h2 id="3-Class"><a href="#3-Class" class="headerlink" title="3. Class"></a>3. Class</h2><h3 id="3-1-Class类介绍"><a href="#3-1-Class类介绍" class="headerlink" title="3.1 Class类介绍"></a>3.1 Class类介绍</h3><p>书中是这样解释Class的：</p>
<blockquote>
<p>在程序运行期间，Java运行时系统始终为所有的对象维护一个被称为运行时类型标识(<em>runtime type identication</em>)。这个信息保存着每个对象所属的类足迹。虚拟机利用运行时信息选择相应的方法执行。保存这些信息的类被称为Class。</p>
</blockquote>
<p>我们再看看这个类的概述：</p>
<blockquote>
<p>Instances of the class Class represent classes and interfaces in a running Java application. An enum is a kind of class and an annotation is a kind of interface. Every array also belongs to a class that is reflected as a Class object that is shared by all arrays with the same element type and number of dimensions. The primitive Java types (boolean, byte, char, short, int, long, float, and double), and the keyword void are also represented as Class objects.<br>Class has no public constructor. Instead Class objects are constructed automatically by the Java Virtual Machine as classes are loaded and by calls to the defineClass method in the class loader.</p>
</blockquote>
<p>意思是说：</p>
<p>Class类的实例代表Java程序运行时的类（classes，枚举也是一种类）和接口（interfaces，注解也是一种接口）。还可以用来代表enum、array、primitive Java types（boolean, byte, char, short, int, long, float, double）以及关键词void。</p>
<p>Class没有public的构造方法，它是在JVM加载类的时候自动实例化的。</p>
<h3 id="3-2-获取Class对象"><a href="#3-2-获取Class对象" class="headerlink" title="3.2 获取Class对象"></a>3.2 获取Class对象</h3><ul>
<li><p>方式一：Object类的getClass()方法将会返回一个Class类实例</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Employee e;</span><br><span class="line">...</span><br><span class="line">Class cls = e.getClass();</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：Class类的静态方法forName方法获取对应的Class类实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String className = <span class="string">"java.util.Date"</span>;</span><br><span class="line">Class cls = Class.forName(className);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式三：如果T是Java类，那么T.class代表匹配的类对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class cls1 = Date.class;</span><br><span class="line">Class cls2 = <span class="keyword">int</span>.class;</span><br><span class="line">Class cls3 = Double[].class;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注意：一个Class对象是用来表示一个类型（type），这个类型不一定都是类（class）。例如int不是一个类，但是int.class就是一个Class类型的对象。</strong></p>
<h3 id="3-3-简单使用"><a href="#3-3-简单使用" class="headerlink" title="3.3 简单使用"></a>3.3 简单使用</h3><p>虚拟机为每一个类型管理一个唯一Class对象（就是说一个type只对应着一个Class对象）。因此可以使用==运算符实现两个类对象的比较。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(e.getClass() == Employee.class)&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>通过Class的newInstance()方法能快速的创建一个类实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Date mDate = Date.class.newInstance();</span><br><span class="line">    <span class="comment">// 或者和forName联合使用</span></span><br><span class="line">    String s = <span class="string">"java.util.Date"</span>;</span><br><span class="line">    Object mDate2 = Class.forName(s).newInstance();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>newInstance方法调用的是类的默认构造方法（无参构造方法）初始化创建的类对象，如果该类没有默认构造方法，将会抛出异常。如果需要使用带参的构造方法的话就不能这样调用了，需要使用Constructor类中的newInstance方法。</p>
<h2 id="4-使用反射分析类"><a href="#4-使用反射分析类" class="headerlink" title="4.使用反射分析类"></a>4.使用反射分析类</h2><p>在java.lang.reflect包中有三个类Field、Method、Constructor分别用于描述普通类的域、方法和构造器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Constructor[] constructors = cls.getConstructors();</span><br><span class="line">Method[] methods = cls.getMethods();</span><br><span class="line">Field[] fields = cls.getFields();</span><br></pre></td></tr></table></figure>
<p><u><strong>Class类中的getFields()、getMethods()、getConstructors()方法将返回类提供的public的域、方法和构造器，并且包括超类的共有成员。getDeclaredField()、getDeclaredMethods()、getDeclaredConstructors()能够获取全部的域、方法、构造器，包括私有的和所保护的成员，但是不包括超类的成员。</strong></u></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Constructor[] constructors = cls.getDeclaredConstructors();</span><br><span class="line">Method[] methods = cls.getDeclaredMethods();</span><br><span class="line">Field[] fields = cls.getDeclaredFields();</span><br></pre></td></tr></table></figure>
<p>同时：</p>
<ol>
<li>可以使用Class类以及Field、Method、Constructor都可以使用getName()获取对应的名称；</li>
<li>使用getModifiers()方法可以获取修饰符；</li>
<li>Method和Constructor使用getParameterTypes()可以获取方法和构造器的参数类型； </li>
<li>Field使用getType()方法可以获取域所属类型的Class对象，即能获取域的类型。</li>
<li>Method使用getReturnType()获取方法返回值类型。</li>
<li>对于修饰符可以使用Modifier类的静态方法toString方法获取对应的名称。Modifier还提供了例如isPublic、isPrivate或者isFinal方法来判断方法或者构造器是否是public、private或者final。</li>
</ol>
<p>打印一个类的信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClass</span><span class="params">(Class cls)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String name = cls.getName();</span><br><span class="line">        Class supCls = cls.getSuperclass();</span><br><span class="line">        printModifiers(cls.getModifiers());</span><br><span class="line">        System.out.print(<span class="string">"class "</span> + name);</span><br><span class="line">        <span class="keyword">if</span> (supCls != <span class="keyword">null</span> &amp;&amp; supCls != Object.class) &#123;</span><br><span class="line">            System.out.printf(<span class="string">" extends "</span> + supCls.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">" &#123;"</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        printConstructors(cls);</span><br><span class="line">        System.out.println();</span><br><span class="line">        printMethods(cls);</span><br><span class="line">        System.out.println();</span><br><span class="line">        printFields(cls);</span><br><span class="line">        System.out.println(<span class="string">"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printConstructors</span><span class="params">(Class cls)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取构造方法</span></span><br><span class="line">        Constructor[] constructors = cls.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor constructor : constructors) &#123;</span><br><span class="line">            printModifiers(constructor.getModifiers());</span><br><span class="line">            System.out.print(constructor.getName());</span><br><span class="line">            <span class="comment">// 获取方法参数</span></span><br><span class="line">            printParameters(constructor.getParameterTypes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printMethods</span><span class="params">(Class cls)</span> </span>&#123;</span><br><span class="line">        Method[] methods = cls.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            printModifiers(method.getModifiers());</span><br><span class="line">            Class returnCls = method.getReturnType();</span><br><span class="line">            System.out.print(returnCls.getName() + <span class="string">" "</span>);</span><br><span class="line">            System.out.print(method.getName());</span><br><span class="line">            printParameters(method.getParameterTypes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printModifiers</span><span class="params">(<span class="keyword">int</span> mod)</span> </span>&#123;</span><br><span class="line">        String modifier = Modifier.toString(mod);</span><br><span class="line">        <span class="keyword">if</span> (modifier.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.print(modifier + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFields</span><span class="params">(Class cls)</span> </span>&#123;</span><br><span class="line">        Field[] fields = cls.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            printModifiers(field.getModifiers());</span><br><span class="line">            Class type = field.getType();</span><br><span class="line">            System.out.print(type.getName() + <span class="string">" "</span>);</span><br><span class="line">            System.out.println(field.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printParameters</span><span class="params">(Class[] parameters)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"("</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">", "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(parameters[i].getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">");"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"></span><br><span class="line">打印一下Double.class：</span><br><span class="line"></span><br><span class="line">```<span class="function">java</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        printClass(Double.class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Double</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Number</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> java.lang.Double(<span class="keyword">double</span>);</span><br><span class="line"><span class="keyword">public</span> java.lang.Double(java.lang.String);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(java.lang.Object)</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> java.lang.<span class="function">String <span class="title">toString</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="keyword">public</span> java.lang.<span class="function">String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">min</span><span class="params">(<span class="keyword">double</span>, <span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">max</span><span class="params">(<span class="keyword">double</span>, <span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">long</span> <span class="title">doubleToRawLongBits</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">doubleToLongBits</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">double</span> <span class="title">longBitsToDouble</span><span class="params">(<span class="keyword">long</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(java.lang.Object)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(java.lang.Double)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">byte</span> <span class="title">byteValue</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">shortValue</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">intValue</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">longValue</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">floatValue</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">doubleValue</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> java.lang.<span class="function">Double <span class="title">valueOf</span><span class="params">(java.lang.String)</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> java.lang.<span class="function">Double <span class="title">valueOf</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> java.lang.<span class="function">String <span class="title">toHexString</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">double</span>, <span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNaN</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isNaN</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isInfinite</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInfinite</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isFinite</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">sum</span><span class="params">(<span class="keyword">double</span>, <span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">parseDouble</span><span class="params">(java.lang.String)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> POSITIVE_INFINITY</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> NEGATIVE_INFINITY</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> NaN</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> MAX_VALUE</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> MIN_NORMAL</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> MIN_VALUE</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_EXPONENT</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_EXPONENT</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BYTES</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.Class TYPE</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> value</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-使用反射分析对象"><a href="#5-使用反射分析对象" class="headerlink" title="5.使用反射分析对象"></a>5.使用反射分析对象</h2><p>前面我们获取了对象（或者说类）的域名称和类型。那么如何获取域的值呢？</p>
<p>使用Field的get(obj)方法获取:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User mUser = <span class="keyword">new</span> User(<span class="string">"Jim"</span>, <span class="number">15</span>);<span class="comment">// name和age</span></span><br><span class="line">Class cls = mUser.getClass();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">     Field nameField = cls.getDeclaredField(<span class="string">"name"</span>);</span><br><span class="line">     Object name = nameField.get(mUser);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上，如果name是private的话是会抛出java.lang.IllegalAccessException异常的。因为，反射机制的默认行为受限于Java的访问限制。这个时候需要使用setAccessible(true)覆盖访问控制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">User mUser = <span class="keyword">new</span> User(<span class="string">"Jim"</span>, <span class="number">15</span>);</span><br><span class="line">Class cls = mUser.getClass();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Field nameField = cls.getDeclaredField(<span class="string">"name"</span>);</span><br><span class="line">  nameField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">  Object name = nameField.get(mUser);</span><br><span class="line">  System.out.println(name);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，如果是获取基本类型的话可以使用Field的对应方法，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Field ageField = cls.getDeclaredField(<span class="string">"age"</span>);</span><br><span class="line">ageField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">int</span> age = ageField.getInt(mUser);</span><br></pre></td></tr></table></figure>
<p>setAccessible是AccessibleObject类的方法，AccessibleObject是Field、Method、Constructor       的超类。</p>
<h2 id="6-使用反射操作数组"><a href="#6-使用反射操作数组" class="headerlink" title="6.使用反射操作数组"></a>6.使用反射操作数组</h2><p>java.lang.reflect包下的Array类使用操作数组的，可以使用Array的静态方法newInstance构建新的数组，使用getLength获取数组长度，使用get、getXXX获取数组数组自定位置的内容，使用set、setXXX设置内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ary[] = (<span class="keyword">int</span>[]) Array.newInstance(<span class="keyword">int</span>.class, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Array.getLength(ary); i++) &#123;</span><br><span class="line">  Array.set(ary, i, i * i);</span><br><span class="line">  <span class="comment">// Array.setInt(ary, i, i * i);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-使用反射操作方法"><a href="#7-使用反射操作方法" class="headerlink" title="7.使用反射操作方法"></a>7.使用反射操作方法</h2><blockquote>
<p>Recall that you can inspect a field of an object with the get method of the Field class. Similarly, the Method class has an invoke method that lets you call the method that is wrapped in the current Method object. The signature for the invoke method is<br>Object invoke(Object obj, Object… args)<br>The first parameter is the implicit parameter, and the remaining objects provide the explicit parameters.<br>For a static method, the first parameter is ignored—you can set it to null.</p>
</blockquote>
<p>Method类提供了一个invoke方法用来包装当前对象的方法：<br>Object invoke(Object obj, Object… args)<br>第一个参数是隐藏参数，表示调用方法的对象；其他参数为显示参数，用以表示方法的参数。如果是静态方法，第一个参数为null。</p>
<p>假如User类有一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以通过反射这样调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  User demo = <span class="keyword">new</span> User();</span><br><span class="line">  Method m = demo.getClass().getDeclaredMethod(<span class="string">"calculate"</span>, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="keyword">int</span> value = (<span class="keyword">int</span>) m.invoke(demo, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  System.out.println(<span class="string">"反射计算:"</span> + value);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchMethodException | InvocationTargetException | IllegalAccessException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于静态方法，我们假如调用Math的sqrt(double)方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Method sqrtMethod = Math.class.getDeclaredMethod(<span class="string">"sqrt"</span>, <span class="keyword">double</span>.class);</span><br><span class="line">  <span class="keyword">double</span> value = (<span class="keyword">double</span>) sqrtMethod.invoke(<span class="keyword">null</span>, <span class="number">4</span>);</span><br><span class="line">  System.out.printf(<span class="string">"%.1f"</span>,value);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchMethodException | InvocationTargetException | IllegalAccessException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<ol>
<li>使用invoke方法获取的值是Object的。</li>
<li>使用invoke反射会比直接调用方法明显慢一些。</li>
</ol>
<p><strong>所以：仅在必要的时候才使用Method对象。</strong></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.qinglinyi.com/posts/reflective-note/" data-id="civ3g0zll001dfgs6l9kgpshp" class="article-share-link">Aktie</a><div class="tags"><a href="/tags/Java/">Java</a><a href="/tags/反射/">反射</a><a href="/tags/笔记/">笔记</a></div><div class="post-nav"><a href="/posts/about-string/" class="pre">关于Java String</a><a href="/posts/fragment-arg/" class="next">使用注解操作Fragment Argument</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.qinglinyi.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Java基础/" style="font-size: 15px;">Java基础</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/属性动画/" style="font-size: 15px;">属性动画</a> <a href="/tags/Handler/" style="font-size: 15px;">Handler</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Fragment/" style="font-size: 15px;">Fragment</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/String/" style="font-size: 15px;">String</a> <a href="/tags/property-animation/" style="font-size: 15px;">property animation</a> <a href="/tags/并发/" style="font-size: 15px;">并发</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/Log/" style="font-size: 15px;">Log</a> <a href="/tags/源码解析/" style="font-size: 15px;">源码解析</a> <a href="/tags/记录/" style="font-size: 15px;">记录</a> <a href="/tags/反射/" style="font-size: 15px;">反射</a> <a href="/tags/笔记/" style="font-size: 15px;">笔记</a> <a href="/tags/Retrofit2/" style="font-size: 15px;">Retrofit2</a> <a href="/tags/Retrofit/" style="font-size: 15px;">Retrofit</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/Window/">Window</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/Context/">Context的创建过程</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/zipalign/">zipalign</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ColorMatrix/">ColorMatrix</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/java-concurrency-1/">Java并发(2)-并发基础</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/java-concurrency-0/">Java并发(1)-基础概念</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/logger/">Logger源码解析</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/about-android-handler/">Android Handler消息机制</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/about-string/">关于Java String</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/reflective-note/">Java反射--笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">青林亦.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>